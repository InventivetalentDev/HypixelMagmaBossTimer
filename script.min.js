$(document).ready(function(){function p(){c=Date.now();q++;var a=moment.duration(c-b.latest.spawn).asHours(),l=moment.duration(c-b.latest.death).asHours(),d=moment.duration(b.estimate-c).asMinutes(),r=moment.duration(c-b.latest.spawn).asMinutes(),e=moment.duration(c-b.latest.blaze).asMinutes(),f=moment.duration(c-b.latest.magma).asMinutes(),g=moment.duration(c-b.latest.music).asMinutes();$("#nextTime").text("("+moment(b.estimate).format("MMMM Do YYYY, h:mm:ss a")+")");var h=b.latest.death>b.latest.spawn,
k=h?b.latest.death:b.latest.spawn;$("#lastTrackedType").text(h?"death":"spawn");$("#lastTrackedTime").html(moment(k).fromNow()+"<br/> ("+moment(k).format("MMMM Do YYYY, h:mm:ss a")+")"+(5<a&&5<l?"<br/><i>The timer could likely be inaccurate, since server restarts etc. are not accounted for</i>":""));0>=b.latest.death&&0>=b.latest.spawn&&$("#lastTrackedWrapper").hide();a=b.estimate-c;l=moment.utc(a).format("HH:mm:ss");0<a?($("#time").text(l),$("#timerText").text("The Magma Boss should spawn in about")):
($("#time").text("NOW"),$("#timerText").text("The Magma Boss should spawn"));$("head title",window.parent.document).text(l+" | Hypixel Skyblock Magma Boss Timer");15<q&&0===c%2&&(25<d?$("#waveBlazeBtn").hide():$("#waveBlazeBtn").show(),30>e&&5<e&&$("#waveBlazeBtn").attr("disabled",!0),12E5>c-b.latest.blaze?($("#waveBlazeTime").text("("+moment(b.latest.blaze).fromNow()+")"),$("#waveBlazeBtn").attr("data-tooltip",b.latestConfirmations.blaze+" Confirmations")):($("#waveBlazeTime").text(""),$("#waveBlazeBtn").attr("data-tooltip",
"Not Confirmed")),15<d?$("#waveMagmaBtn").hide():$("#waveMagmaBtn").show(),30>f&&5<f&&$("#waveMagmaBtn").attr("disabled",!0),6E5>c-b.latest.magma?($("#waveMagmaTime").text("("+moment(b.latest.magma).fromNow()+")"),$("#waveMagmaBtn").attr("data-tooltip",b.latestConfirmations.magma+" Confirmations")):($("#waveMagmaTime").text(""),$("#waveMagmaBtn").attr("data-tooltip","Not Confirmed")),5<d?$("#musicBtn").hide():$("#musicBtn").show(),30>g&&5<g&&$("#musicBtn").attr("disabled",!0),3E5>c-b.latest.music?
($("#musicTime").text("("+moment(b.latest.music).fromNow()+")"),$("#musicBtn").attr("data-tooltip",b.latestConfirmations.music+" Confirmations")):($("#musicTime").text(""),$("#musicBtn").attr("data-tooltip","Not Confirmed")),4<d&&1<r?$("#spawnedBtn").hide():$("#spawnedBtn").show(),3E5>c-b.latest.spawn?($("#spawnTime").text("("+moment(b.latest.spawn).fromNow()+")"),$("#spawnedBtn").attr("data-tooltip",b.latestConfirmations.spawn+" Confirmations")):($("#spawnTime").text(""),$("#spawnedBtn").attr("data-tooltip",
"Not Confirmed")),1<d&&2<r?$("#deathBtn").hide():$("#deathBtn").show(),3E5>c-b.latest.death?($("#deathTime").text("("+moment(b.latest.death).fromNow()+")"),$("#deathBtn").attr("data-tooltip",b.latestConfirmations.death+" Confirmations")):($("#deathTime").text(""),$("#deathBtn").attr("data-tooltip","Not Confirmed")),$(".track-btn.tooltipped").tooltip({position:"left"}),$(".track-btn:visible").length?$("#buttonNote").show():$("#buttonNote").hide());d="";6E5>a?(d="If you're not already in the Blazing Fortress, you should get going!",
"true"===localStorage.getItem("tenMinNotification")&&(n||m||(n=t("The Skyblock Magma Boss should spawn in less than 10 minutes!")))):n=null;3E5>a?(d="Get ready!","true"===localStorage.getItem("fiveMinNotification")&&(m||(m=t("The Skyblock Magma Boss should spawn in less than five minutes!")))):m=null;$("#suggestionMessage").text(d)}function h(){$.ajax("get_estimated_spawn"+(u?"3":"")+".php").done(function(a){console.log(a);b=a;p();clearInterval(v);v=setInterval(p,1E3)});$.ajax("get_active_users.php").done(function(a){$("#activeUserCount").text(a)})}
function w(){$.ajax({method:"POST",url:"ping.php",data:{lastFocused:Math.floor(x),minecraftUser:$("#mcUsername").val(),ipv4:f,ipv6:g}})}function e(a,b,c,e){var d=$("#mcUsername").val();B(c,function(c){c&&(a.attr("disabled",!0),$.ajax({method:"POST",url:"add_event.php",data:{type:b,captcha:y,username:d,ipv4:f,ipv6:g}}).done(function(){a.attr("disabled",!0);e||h()}))})}function z(){$.ajax("history_chart.php?hours="+k).done(function(a){Highcharts.chart("timelineChart",{chart:{zoomType:"x",type:"timeline",
height:"20%",backgroundColor:"rgb(55, 40, 47)",marginLeft:80,marginRight:80},xAxis:{type:"datetime",visible:!1},yAxis:{gridLineWidth:1,title:null,labels:{enabled:!1}},legend:{enabled:!1},title:{text:null},tooltip:{style:{},formatter:function(){var a=Highcharts.dateFormat("%y-%m-%d",this.x),b=Highcharts.dateFormat("%H:%M:%S",this.x);return'<span style="color:'+this.point.color+'">\u25cf</span> '+this.point.name+"<br/><span>"+(a+" <b>"+b+"</b></span><br/><span>(")+(this.point.confirmations+" confirmations)</span>")},
headerFormat:'<span style="color:{point.color}">\u25cf</span> {point.key}<br/>',pointFormat:"<span>{point.x:%y-%m-%d} <b>{point.x:%H:%M:%S}</b></span><br/>",footerFormat:""},series:[{dataLabels:{allowOverlap:!1},marker:{symbol:"circle"},data:a}]})})}function t(a,b){if("Notification"in window)if("granted"!==Notification.permission)console.warn("Notifications not granted");else return new Notification(b||"Magma Boss Reminder",{body:a,icon:"https://hypixel.inventivetalent.org/img/Magma_Cube_50px.png"});
else console.warn("Browser does not support notifications")}function B(a,e){function d(){grecaptcha.execute("6LeaYLIUAAAAAHfC2C6GsI84CW5sJjuaZA9FERRE",{action:(a||"homepage").replace(/ /gi,"_")}).then(function(a){console.log("got recaptcha token");y=a;e(!0)});return!0}return 54E5<b.estimate-c?1==confirm("The next estimated spawn phase has not yet started. Are you sure you want add "+(a||"a spawn")+"?")?d():!1:d()}$("#infoModal").modal();$("#timelineModal").modal({onOpenEnd:function(){z()}});$(".track-btn.tooltipped").tooltip({position:"left"});
var y=null;grecaptcha.ready(function(){console.log("recaptcha ready");$(".track-btn").attr("disabled",!1)});var A=Math.floor(9*Math.random())+1;$("#bgImage").css("background-image","url(img/bg/"+A+".jpg), url(img/bg/"+A+".png)");var u="#DEV"===window.location.hash;u&&$("#d").text("DEV MODE ACTIVE");var c=(new Date).getTime(),q=0,n,m,b={},v=-1,k=4,x=c/1E3,f="",g="";h();setInterval(h,3E4);w();setInterval(w,3E4);$("#waveBlazeBtn").click(function(){var a=$(this);e(a,"blaze","a blaze wave",!1)});$("#waveMagmaBtn").click(function(){var a=
$(this);e(a,"magma","a magma wave",!1)});$("#musicBtn").click(function(){var a=$(this);e(a,"music","music",!1)});$("#spawnedBtn").click(function(){var a=$(this);e(a,"spawn","a boss spawn",!1)});$("#deathBtn").click(function(){var a=$(this);e(a,"death","a boss death",!0)});$("#tenMinNotificationSwitch").prop("checked","true"===localStorage.getItem("tenMinNotification"));$("#tenMinNotificationSwitch").change(function(){$(this).is(":checked")?Notification.requestPermission().then(function(a){console.log(a);
localStorage.setItem("tenMinNotification","true")}):localStorage.setItem("tenMinNotification","false")});$("#fiveMinNotificationSwitch").prop("checked","true"===localStorage.getItem("fiveMinNotification"));$("#fiveMinNotificationSwitch").change(function(){$(this).is(":checked")?Notification.requestPermission().then(function(a){console.log(a);localStorage.setItem("fiveMinNotification","true")}):localStorage.setItem("fiveMinNotification","false")});$("#mcUsername").val(localStorage.getItem("mcUsername")||
"");$("#mcUsername").on("change",function(){localStorage.setItem("mcUsername",$(this).val())});$("#timelineLoadMore").click(function(){24>k?k+=2:$(this).attr("disabled",!0);z()});$(window).on("focus blur",function(){x=Date.now()/1E3});$.getJSON("https://api.ipify.org?format=jsonp&callback=?",function(a){f=a.ip;console.log("IPv4: "+f)});$.getJSON("https://api6.ipify.org?format=jsonp&callback=?",function(a){g=a.ip;console.log("IPv6: "+g)})});
