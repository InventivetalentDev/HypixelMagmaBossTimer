$(document).ready(function(){function q(){b=Date.now();r++;var c=moment.duration(b-a.latest.spawn).asHours(),l=moment.duration(b-a.latest.death).asHours(),e=moment.duration(a.estimate-b).asMinutes(),f=moment.duration(b-a.latest.spawn).asMinutes(),g=moment.duration(b-a.latest.blaze).asMinutes(),d=moment.duration(b-a.latest.magma).asMinutes(),m=moment.duration(b-a.latest.music).asMinutes();$("#nextTime").text("("+moment(a.estimate).format("MMMM Do YYYY, h:mm:ss a")+")");var h=a.latest.death>a.latest.spawn,
k=h?a.latest.death:a.latest.spawn;$("#lastTrackedType").text(h?"death":"spawn");$("#lastTrackedTime").html(moment(k).fromNow()+"<br/> ("+moment(k).format("MMMM Do YYYY, h:mm:ss a")+")"+(5<c&&5<l?"<br/><i>The timer could likely be inaccurate, since server restarts etc. are not accounted for</i>":""));0>=a.latest.death&&0>=a.latest.spawn&&$("#lastTrackedWrapper").hide();c=a.estimate-b;l=moment.utc(c).format("HH:mm:ss");0<c?($("#time").text(l),$("#timerText").text("The Magma Boss should spawn in about")):
($("#time").text("NOW"),$("#timerText").text("The Magma Boss should spawn"));$("head title",window.parent.document).text(l+" | Hypixel Skyblock Magma Boss Timer");15<r&&0===b%2&&(25<e?$("#waveBlazeBtn").hide():$("#waveBlazeBtn").show(),(30>g&&5<g||0===a.latest.blaze&&30>d&&1<d)&&$("#waveBlazeBtn").attr("disabled",!0),12E5>b-a.latest.blaze?($("#waveBlazeTime").text("("+moment(a.latest.blaze).fromNow()+")"),$("#waveBlazeBtn").attr("data-tooltip",a.latestConfirmations.blaze+" Confirmations")):($("#waveBlazeTime").text(""),
$("#waveBlazeBtn").attr("data-tooltip","Not Confirmed")),15<e?$("#waveMagmaBtn").hide():$("#waveMagmaBtn").show(),(30>d&&5<d||0===a.latest.magma&&30>m&&1<m)&&$("#waveMagmaBtn").attr("disabled",!0),6E5>b-a.latest.magma?($("#waveMagmaTime").text("("+moment(a.latest.magma).fromNow()+")"),$("#waveMagmaBtn").attr("data-tooltip",a.latestConfirmations.magma+" Confirmations")):($("#waveMagmaTime").text(""),$("#waveMagmaBtn").attr("data-tooltip","Not Confirmed")),5<e?$("#musicBtn").hide():$("#musicBtn").show(),
30>m&&5<m&&$("#musicBtn").attr("disabled",!0),3E5>b-a.latest.music?($("#musicTime").text("("+moment(a.latest.music).fromNow()+")"),$("#musicBtn").attr("data-tooltip",a.latestConfirmations.music+" Confirmations")):($("#musicTime").text(""),$("#musicBtn").attr("data-tooltip","Not Confirmed")),4<e&&1<f?$("#spawnedBtn").hide():$("#spawnedBtn").show(),3E5>b-a.latest.spawn?($("#spawnTime").text("("+moment(a.latest.spawn).fromNow()+")"),$("#spawnedBtn").attr("data-tooltip",a.latestConfirmations.spawn+" Confirmations")):
($("#spawnTime").text(""),$("#spawnedBtn").attr("data-tooltip","Not Confirmed")),1<e&&2<f?$("#deathBtn").hide():$("#deathBtn").show(),3E5>b-a.latest.death?($("#deathTime").text("("+moment(a.latest.death).fromNow()+")"),$("#deathBtn").attr("data-tooltip",a.latestConfirmations.death+" Confirmations")):($("#deathTime").text(""),$("#deathBtn").attr("data-tooltip","Not Confirmed")),$(".track-btn.tooltipped").tooltip({position:"left"}),$(".track-btn:visible").length?$("#buttonNote").show():$("#buttonNote").hide());
e="";3E5>c?(e="Get ready!","true"===localStorage.getItem("fiveMinNotification")&&(n||(n=t("The Skyblock Magma Boss should spawn in less than five minutes!")))):n=null;6E5>c?(e="If you're not already in the Blazing Fortress, you should get going!","true"===localStorage.getItem("tenMinNotification")&&(p||n||(p=t("The Skyblock Magma Boss should spawn in less than 10 minutes!")))):p=null;$("#suggestionMessage").text(e)}function h(){$.ajax("https://hypixel-api.inventivetalent.org/api/skyblock/bosstimer/magma/estimatedSpawn").done(function(c){console.log(c);
a=c;q();clearInterval(u);u=setInterval(q,1E3)})}function v(){$.ajax({method:"POST",url:"https://hypixel-api.inventivetalent.org/api/skyblock/bosstimer/magma/ping",data:{lastFocused:Math.floor(w),minecraftUser:$("#mcUsername").val(),ipv4:g,ipv6:d}})}function f(c,a,b,d){$("#addEventType").val(a);$("#confirmationModal").modal("open");c.attr("disabled",!0)}function x(){$.ajax("https://hypixel-api.inventivetalent.org/api/skyblock/bosstimer/magma/historyChart?hours="+k).done(function(c){Highcharts.chart("timelineChart",
{chart:{zoomType:"x",type:"timeline",height:"20%",backgroundColor:"rgb(55, 40, 47)",marginLeft:80,marginRight:80},xAxis:{type:"datetime",visible:!1},yAxis:{gridLineWidth:1,title:null,labels:{enabled:!1}},legend:{enabled:!1},title:{text:null},tooltip:{style:{},formatter:function(){var c=Highcharts.dateFormat("%y-%m-%d",this.x),a=Highcharts.dateFormat("%H:%M:%S",this.x);return'<span style="color:'+this.point.color+'">\u25cf</span> '+this.point.name+"<br/><span>"+(c+" <b>"+a+"</b></span><br/><span>(")+
(this.point.confirmations+" confirmations)</span>")},headerFormat:'<span style="color:{point.color}">\u25cf</span> {point.key}<br/>',pointFormat:"<span>{point.x:%y-%m-%d} <b>{point.x:%H:%M:%S}</b></span><br/>",footerFormat:""},series:[{dataLabels:{allowOverlap:!1},marker:{symbol:"circle"},data:c.chart}]})})}function t(c,a){if("Notification"in window)if("granted"!==Notification.permission)console.warn("Notifications not granted");else return new Notification(a||"Magma Boss Reminder",{body:c,icon:"https://hypixel.inventivetalent.org/img/Magma_Cube_50px.png"});
else console.warn("Browser does not support notifications")}$("#infoModal").modal();$("#timelineModal").modal({onOpenEnd:function(){x()}});$("#confirmationModal").modal({onCloseStart:function(){$("#addEventType").val("");$("#captchaConfirmSubmit").hide()}});$("#eventInfoModal").modal({onOpenEnd:function(){$("#blazeWaveVideo")[0].play();$("#magmaWaveVideo")[0].play();$("#magmaBossVideo")[0].play()}});$(".track-btn.tooltipped").tooltip({position:"left"});grecaptcha.ready(function(){console.log("recaptcha ready");
$(".track-btn").attr("disabled",!1)});var y=Math.floor(9*Math.random())+1;$("#bgImage").css("background-image","url(img/bg/"+y+".jpg), url(img/bg/"+y+".png)");"#DEV"===window.location.hash&&$("#d").text("DEV MODE ACTIVE");var b=(new Date).getTime(),r=0,p,n,a={},u=-1,k=4,w=b/1E3,g="",d="";h();setInterval(h,3E4);v();setInterval(v,3E4);$("#waveBlazeBtn").click(function(){var a=$(this);f(a,"blaze","a blaze wave",!1)});$("#waveMagmaBtn").click(function(){var a=$(this);f(a,"magma","a magma wave",!1)});
$("#musicBtn").click(function(){var a=$(this);f(a,"music","music",!1)});$("#spawnedBtn").click(function(){var a=$(this);f(a,"spawn","a boss spawn",!1)});$("#deathBtn").click(function(){var a=$(this);f(a,"death","a boss death",!0)});$("#eventConfirmationForm").on("submit",function(a){a.preventDefault();$("#captchaConfirmSubmit").attr("disabled",!0);if(a=$("#addEventType").val()){var c=grecaptcha.getResponse(),b=$("#mcUsername").val();$.ajax({method:"POST",url:"https://hypixel-api.inventivetalent.org/api/skyblock/bosstimer/magma/addEvent",
data:{type:a,captcha:c,username:b,ipv4:g,ipv6:d}}).done(function(){$("#confirmationModal").modal("close");h()})}});$("#tenMinNotificationSwitch").prop("checked","true"===localStorage.getItem("tenMinNotification"));$("#tenMinNotificationSwitch").change(function(){$(this).is(":checked")?Notification.requestPermission().then(function(a){console.log(a);localStorage.setItem("tenMinNotification","true")}):localStorage.setItem("tenMinNotification","false")});$("#fiveMinNotificationSwitch").prop("checked",
"true"===localStorage.getItem("fiveMinNotification"));$("#fiveMinNotificationSwitch").change(function(){$(this).is(":checked")?Notification.requestPermission().then(function(a){console.log(a);localStorage.setItem("fiveMinNotification","true")}):localStorage.setItem("fiveMinNotification","false")});$("#mcUsername").val(localStorage.getItem("mcUsername")||"");$("#mcUsername").on("change",function(){localStorage.setItem("mcUsername",$(this).val())});$("#timelineLoadMore").click(function(){24>k?k+=2:
$(this).attr("disabled",!0);x()});$(window).on("focus blur",function(){w=Date.now()/1E3});$.getJSON("https://api.ipify.org?format=jsonp&callback=?",function(a){g=a.ip;console.log("IPv4: "+g)});$.getJSON("https://api6.ipify.org?format=jsonp&callback=?",function(a){d=a.ip;console.log("IPv6: "+d)})});
